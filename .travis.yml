language: python
services:
  - docker
install:
  - echo "Nothing to install"
env:
  global:
    - ENERGYPLUS_VERSION: 9.5.0
    - ENERGYPLUS_SHA: de239b2e5f
    - ENERGYPLUS_INSTALL_VERSION: 9-5-0
jobs:
  include:
    - stage: test and build
      sudo: required
      script:
        - docker build -t energyplus:latest --build-arg ENERGYPLUS_VERSION=$ENERGYPLUS_VERSION --build-arg ENERGYPLUS_SHA=$ENERGYPLUS_SHA --build-arg ENERGYPLUS_INSTALL_VERSION=$ENERGYPLUS_INSTALL_VERSION .
        - docker run -it energyplus:latest EnergyPlus --version
        - docker run -it --rm energyplus:latest /bin/bash -c "cd /var/simdata/energyplus && EnergyPlus -D ../1ZoneUncontrolled.idf"
        - docker run -it --rm energyplus:latest /bin/bash -c "cd /var/simdata/energyplus && EnergyPlus -D ../PythonPluginCustomOutputVariable.idf"
      after_success:
        - ./deploy_docker.sh
